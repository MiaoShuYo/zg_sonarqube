# 测试用Dockerfile - 专门用于诊断gradlew问题
FROM eclipse-temurin:17-jdk-jammy

# 设置工作目录
WORKDIR /app

# 安装必要的工具
RUN apt-get update && apt-get install -y \
  unzip \
  curl \
  dos2unix \
  file \
  && rm -rf /var/lib/apt/lists/*

# 复制gradlew文件
COPY gradlew ./

# 诊断gradlew文件
RUN echo "=== 原始文件信息 ===" && \
  ls -la gradlew && \
  file gradlew && \
  echo "=== 文件前10行 ===" && \
  head -10 gradlew && \
  echo "=== 修复权限 ===" && \
  chmod +x gradlew && \
  echo "=== 修复换行符 ===" && \
  dos2unix gradlew && \
  echo "=== 修复后信息 ===" && \
  ls -la gradlew && \
  file gradlew && \
  echo "=== 测试执行 ===" && \
  ./gradlew --version

# 如果成功，继续构建
RUN echo "✅ gradlew修复成功，继续构建..." && \
  ./gradlew :sonar-application:zip --no-daemon --parallel=false --max-workers=1 